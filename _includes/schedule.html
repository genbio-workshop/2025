{% assign schedule = site.data.schedule %}
{% assign size = schedule.size %}
{% if size == False %}

<!-- A preliminary day-of schedule -->
<!-- can be found -->
<!-- <a href="https://neurips.cc/virtual/2023/workshop/66505">here</a>. -->

{% else %}
    <!-- Generate modals for all events with abstracts -->
    {% for event in schedule %}
        {% if event.Sessions %}
            {% for session in event.Sessions %}
                {% if session.Abstract %}
                    <div class="modal fade" id="talk_{{ forloop.parentloop.index }}_{{ forloop.index }}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <b>Title:</b> {{ session.Title }}
                                    <br>
                                    <b>Presenter:</b> {{ session.Presenter }}
                                    <br>
                                    {% if session.Is_paper == false %}
                                        <b>Bio</b><p class="par_panel_perso">{{ session.Bio }}</p>
                                    {% else %}
                                        <b>Authors</b><p class="par_panel_perso">{{ session.Authors }}</p>
                                    {% endif %}
                                    <b>Abstract</b><p class="par_panel_perso">{{ session.Abstract }}</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        {% elsif event.Abstract %}
            <div class="modal fade" id="talk_{{ forloop.index }}" tabindex="-1" aria-hidden="true">
                <!-- Single event modal (same as before) -->
            </div>
        {% endif %}
    {% endfor %}
    
    <div class="schedule-container">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Title</th>
                    <th>Presenter</th>
                </tr>
            </thead>
            <tbody>
                {% for event in schedule %}
                    <tr>
                        {% if forloop.first == false %}
                            {% assign prev_time = schedule[forloop.index0 | minus: 1].Time %}
                            {% if event.Time == prev_time %}
                                <td></td>
                            {% else %}
                                <td>{{ event.Time }}</td>
                            {% endif %}
                        {% else %}
                            <td>{{ event.Time }}</td>
                        {% endif %}

                        {% if event.Sessions %}
                            <!-- Handle multiple sessions in one time slot with overall title -->
                            <td colspan="2">
                                <div class="parallel-session-group">
                                <div class="session-group-title">{{ event.Session_Title }}</div>
                                <div class="parallel-sessions">
                                    {% for session in event.Sessions %}
                                    <div class="session">
                                        <strong>{{ session.Title }}</strong>
                                        {% if session.Abstract %}
                                        <a href="" data-bs-toggle="modal" data-bs-target="#talk_{{ forloop.parentloop.index }}_{{ forloop.index }}">
                                            <i class="bi bi-info-circle info-icon"></i>
                                        </a>
                                        {% endif %}
                                        <div class="presenter">{{ session.Presenter }}</div>
                                    </div>
                                    {% unless forloop.last %}<hr class="session-divider">{% endunless %}
                                    {% endfor %}
                                </div>
                                </div>
                            </td>
                        {% elsif event.Whole_line == true %}
                            <td colspan="2">{{ event.Title }}</td>
                        {% else %}
                            {% if event.Abstract %}
                                <td class="title-cell">
                                    {{ event.Title }}
                                    <a href="" data-bs-toggle="modal" data-bs-target="#talk_{{ forloop.index }}">
                                        <i class="bi bi-info-circle info-icon"></i>
                                    </a>
                                </td>
                            {% else %}
                                <td>{{ event.Title }}</td>
                            {% endif %}
                            <td>{{ event.Presenter }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}

<style>
    /* Previous CSS remains the same, add these new styles */
    .parallel-sessions {
        padding: 8px 0;
    }
    
    .session {
        margin: 8px 0;
    }
    
    .session-divider {
        margin: 8px 0;
        border: 0;
        border-top: 1px dashed #ccc;
    }
    
    .presenter {
        font-style: italic;
        color: #555;
        margin-top: 4px;
    }
    
    .session-group-title {
    font-weight: bold;
    font-size: 1.1em;
    color: #2c3e50;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 2px solid #eee;
    }

    /* Keep all your existing styles, add this new one */
    .parallel-session-group {
    padding: 12px;
    }
</style>